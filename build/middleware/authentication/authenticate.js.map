{"version":3,"sources":["../../../src/middleware/authentication/authenticate.js"],"names":["Authenticate","verifyToken","req","res","next","token","headers","jwt","verify","process","env","APP_SECRET","sub","username","query","queryFunction","rows","user","message"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;;;;;AAEA,IAAMA,YAAY,GAAG;AACbC,EAAAA,WADa,uBACDC,GADC,EACIC,GADJ,EACSC,IADT,EACe;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC1BC,cAAAA,KAD0B,GAClBH,GAAG,CAACI,OAAJ,CAAY,gBAAZ,CADkB;;AAAA,kBAE3BD,KAF2B;AAAA;AAAA;AAAA;;AAAA,+CAGvB,6BAAeF,GAAf,EAAoB,uBAApB,EAA6C,GAA7C,CAHuB;;AAAA;AAAA;AAAA;AAAA,qBAMRI,sBAAIC,MAAJ,CAAWH,KAAX,EAAkBI,OAAO,CAACC,GAAR,CAAYC,UAA9B,CANQ;;AAAA;AAAA;AAMtBC,cAAAA,GANsB,QAMtBA,GANsB;AAOtBC,cAAAA,QAPsB,GAOTD,GAPS,CAOtBC,QAPsB;AAQxBC,cAAAA,KARwB,GAQhB,yCARgB;AAAA;AAAA,qBASPC,kBAAcD,KAAd,CAAoBA,KAApB,EAA2B,CAACD,QAAD,CAA3B,CATO;;AAAA;AAAA;AAStBG,cAAAA,IATsB,SAStBA,IATsB;;AAAA,kBAUzBA,IAAI,CAAC,CAAD,CAVqB;AAAA;AAAA;AAAA;;AAAA,+CAWrB,6BAAeb,GAAf,EAAoB,mCAApB,EAAyD,GAAzD,CAXqB;;AAAA;AAAA,qCAafa,IAbe,MAavBC,IAbuB;AAc9Bf,cAAAA,GAAG,CAACe,IAAJ,GAAWA,IAAX;AAd8B,+CAevBb,IAAI,EAfmB;;AAAA;AAAA;AAAA;AAAA,+CAiBvB,6BAAeD,GAAf,EAAoB,YAAMe,OAA1B,EAAmC,GAAnC,CAjBuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBjC;AApBkB,CAArB;eAuBelB,Y","sourcesContent":["import jwt from 'jsonwebtoken';\nimport queryFunction from '../../database';\nimport serverResponse from '../../utils/serverResponse';\n\nconst Authenticate = {\n  async verifyToken(req, res, next) {\n    const token = req.headers['x-access-token'];\n    if (!token) {\n      return serverResponse(res, 'Token is not provided', 400);\n    }\n    try {\n      const { sub } = await jwt.verify(token, process.env.APP_SECRET);\n      const { username } = sub;\n      const query = 'SELECT * FROM users WHERE username = $1';\n      const { rows } = await queryFunction.query(query, [username]);\n      if (!rows[0]) {\n        return serverResponse(res, 'The token you provided is invalid', 400);\n      }\n      const [user] = rows;\n      req.user = user;\n      return next();\n    } catch (error) {\n      return serverResponse(res, error.message, 400);\n    }\n  },\n};\n\nexport default Authenticate;\n"],"file":"authenticate.js"}